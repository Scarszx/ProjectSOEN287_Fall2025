<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Booking Approval</title>
    <link rel="stylesheet" href="../css/booking_status.css">
    <link rel="stylesheet" href="../css/stylesLOGIN.css">
    <link rel="icon" type="image/png" sizes="32x32" href="../css/icons/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../css/icons/favicon_io/favicon-16x16.png">
</head>
<body>
    <div id="booking-Status">
    <button><a href="page2.html">Back to Home</a></button>
        <h1>Currently Booked Resources</h1>
  <table id="bookedTable">
    <thead>
      <tr>
        <th>Resource ID</th>
        <th>Date</th>
        <th>Start Time</th>
        <th>End Time</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  </div>
    <script>
    async function fetchBookedResources() {
      const resp = await fetch('/api/booked_resources');
      const data = await resp.json();
      return data;
    }

    async function cancelBooking(id) {
      if (!confirm('Are you sure you want to cancel this booking?')) return;
      const resp = await fetch('/api/booked_resources/cancel', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id })
      });
      const data = await resp.json();
      if (data.success) {
        alert('Booking canceled.');
        loadTable();
      } else {
        alert('Error canceling booking: ' + data.message);
      }
    }

    async function loadTable() {
      const bookings = await fetchBookedResources();
      const tbody = document.querySelector('#bookedTable tbody');
      tbody.innerHTML = '';
      if (bookings.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6">No booked resources found.</td></tr>';
        return;
      }
      bookings.forEach(b => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${b.resource_id}</td>
          <td>${b.date}</td>
          <td>${b.start_time}:00</td>
          <td>${b.end_time}:00</td>
          <td>${b.status}</td>
          <td><button onclick="cancelBooking(${b.id})">Cancel</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    window.onload = loadTable;
  </script>
</body>

</html>

